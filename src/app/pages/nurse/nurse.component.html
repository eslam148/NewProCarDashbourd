<div class="container mt-4">
  <h2>{{ 'nurse.title' | translate | async }}</h2>

  <!-- Add Nurse Button -->
  <div class="mb-3" *ngIf="!showForm">
    <button class="btn btn-success rounded-pill px-4" (click)="showAddForm()">
      {{ 'common.add' | translate | async }}
    </button>
  </div>

  <!-- Nurse Form -->
  <form *ngIf="showForm" [formGroup]="form" (ngSubmit)="submit()" class="mb-4 card p-3 shadow-sm">
    <div class="row g-3 align-items-center">
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.name' | translate | async }}</label>
        <div class="input-group">
          <input formControlName="firstName" placeholder="{{ 'nurse.name' | translate | async }}" class="form-control rounded-pill me-1" />
          <input formControlName="lastName" placeholder="{{ 'nurse.name' | translate | async }}" class="form-control rounded-pill" />
        </div>
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.phone' | translate | async }}</label>
        <input formControlName="phoneNumber" placeholder="{{ 'nurse.phone' | translate | async }}" class="form-control rounded-pill" />
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.specialization' | translate | async }}</label>
        <input formControlName="specialization" placeholder="{{ 'nurse.specialization' | translate | async }}" class="form-control rounded-pill" />
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.governorate' | translate | async }}</label>
        <input formControlName="governorate" placeholder="{{ 'nurse.governorate' | translate | async }}" class="form-control rounded-pill" />
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.city' | translate | async }}</label>
        <input formControlName="city" placeholder="{{ 'nurse.city' | translate | async }}" class="form-control rounded-pill" />
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.license' | translate | async }}</label>
        <input formControlName="licenseNumber" placeholder="{{ 'nurse.license' | translate | async }}" class="form-control rounded-pill" />
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.rate' | translate | async }}</label>
        <input formControlName="rate" placeholder="{{ 'nurse.rate' | translate | async }}" class="form-control rounded-pill" type="number" />
      </div>
      <div class="col-12 col-md-6">
        <label class="form-label">{{ 'nurse.image' | translate | async }}</label>
        <input type="file" (change)="onImageSelected($event)" class="form-control rounded-pill" accept="image/*" />
        <img *ngIf="imagePreview" [src]="imagePreview" alt="Preview" width="80" class="mt-2 rounded" />
      </div>
    </div>
    <div class="mt-3 d-flex flex-column flex-md-row gap-2">
      <button type="submit" class="btn btn-primary rounded-pill px-4" [disabled]="form.invalid">
        {{ isEditMode ? ('nurse.edit' | translate | async) : ('common.add' | translate | async) }}
      </button>
      <button type="button" class="btn btn-secondary rounded-pill px-4" (click)="cancel()">
        {{ 'common.cancel' | translate | async }}
      </button>
    </div>
  </form>

  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage | translate | async }}</div>
  <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage | translate | async }}</div>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>{{ 'nurse.image' | translate | async }}</th>
              <th>{{ 'nurse.name' | translate | async }}</th>
              <th>{{ 'nurse.phone' | translate | async }}</th>
              <th>{{ 'nurse.specialization' | translate | async }}</th>
              <th>{{ 'nurse.governorate' | translate | async }}</th>
              <th>{{ 'nurse.city' | translate | async }}</th>
              <th>{{ 'nurse.license' | translate | async }}</th>
              <th>{{ 'nurse.rate' | translate | async }}</th>
              <th class="text-center">{{ 'nurse.actions' | translate | async }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let nurse of nurses">
              <td><img [src]="nurse.imageUrl" alt="nurse" width="48" height="48" class="rounded-circle border"></td>
              <td>{{ nurse.firstName }} {{ nurse.lastName }}</td>
              <td>{{ nurse.phoneNumber }}</td>
              <td>{{ nurse.specialization }}</td>
              <td>{{ nurse.governorate }}</td>
              <td>{{ nurse.city }}</td>
              <td>{{ nurse.licenseNumber }}</td>
              <td>{{ nurse.rate !== null ? nurse.rate : '-' }}</td>
              <td class="text-center">
                <div class="d-inline-flex gap-1">
                  <button class="btn btn-sm btn-info rounded-pill px-3" (click)="editNurse(nurse)">
                    {{ 'nurse.edit' | translate | async }}
                  </button>
                  <button class="btn btn-sm btn-danger rounded-pill px-3" (click)="openDeleteModal(nurse.id)">
                    {{ 'nurse.delete' | translate | async }}
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="nurses.length === 0">
              <td colspan="9" class="text-center text-muted">{{ 'nurse.noData' | translate | async }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal (Bootstrap) -->
  <div class="modal fade show" tabindex="-1"
       [ngStyle]="{display: isDeleteModalOpen ? 'block' : 'none', background: 'rgba(0,0,0,0.4)'}"
       style="z-index: 2000; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-light">
          <h5 class="modal-title">{{ 'nurse.delete' | translate | async }}</h5>
          <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
        </div>
        <div class="modal-body">
          <p>{{ 'nurse.confirmDelete' | translate | async }}</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">
            {{ 'common.cancel' | translate | async }}
          </button>
          <button type="button" class="btn btn-danger" (click)="confirmDelete()">
            {{ 'nurse.delete' | translate | async }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-center mt-4">
    <nav *ngIf="totalCount > pageSize">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="pageNumber === 1">
          <a class="page-link" (click)="onPageChange(pageNumber - 1)">Â«</a>
        </li>
        <li
          class="page-item"
          *ngFor="let page of [].constructor(getPagesCount()); let i = index"
          [class.active]="pageNumber === i + 1"
        >
          <a class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }}</a>
        </li>
        <li class="page-item" [class.disabled]="pageNumber === getPagesCount()">
          <a class="page-link" (click)="onPageChange(pageNumber + 1)">Â»</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
